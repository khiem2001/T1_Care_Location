<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("../../partials/head", { title: "Thêm người dùng" }) %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <% if (typeof error !== 'undefined' && error) { %>
    <div class="bg-red-100 text-red-700 p-4 rounded shadow mx-6 mt-4">
      <%= error %>
    </div>
    <% } %> <%- include('../../partials/layout', { body: `
    <nav class="text-sm text-gray-500 mb-6 flex items-center gap-2">
      <i class="fas fa-house text-purple-600"></i>
      <a href="/users" class="text-purple-600">Danh sách người dùng</a>
      <i class="fas fa-chevron-right text-xs text-gray-400"></i>
      <span class="text-gray-600">Thêm người dùng</span>
    </nav>

    <main class="bg-white p-8 rounded-xl shadow-md max-w-5xl mx-auto mt-6">
      <form
        action=${"/users-edit/"+ record._id +'?_method=PUT'}
        method="post"
        class="grid grid-cols-1 md:grid-cols-2 gap-6"
      >
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Họ & Tên</label
          >
          <input
            name="user_full"
            required
            value="${record.full_name}"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-purple-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Số điện thoại</label
          >
          <input
            name="user_phone"
            required
            value="${record.phone}"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-purple-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            type="email"
            name="user_mail"
            required
            value="${record.email}"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-purple-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Mật khẩu</label
          >
          <input
            type="password"
            name="user_pass"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-purple-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Quyền</label
          >
          <select
            name="user_level"
            class="w-full border border-gray-300 rounded-md px-4 py-2 focus:ring-2 focus:ring-purple-500 bg-white"
          >
          <option value="1" ${record.role == 'admin' ? 'selected' : ''}>Admin</option>
          <option value="2" ${record.role == 'member' ? 'selected' : ''}>Member</option>
          </select>
        </div>

        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Chọn thiết bị</label
          >
          <select
            name="device_ids[]"
            multiple
            class="w-full border border-gray-300 rounded-md px-4 py-2 h-40 focus:ring-2 focus:ring-purple-500 bg-white"
          >
          ${devices.map(device => `
            <option value="${device._id}" ${device.selected ? 'selected' : ''}>
              ${device.code}_${device.name}
            </option>
          `).join('')}
          </select>
          <p class="text-sm text-gray-500 mt-1">
            Giữ Ctrl (Windows) hoặc Command (Mac) để chọn nhiều thiết bị.
          </p>
        </div>

        <div class="md:col-span-2 flex justify-end mt-4">
          <button
            type="submit"
            class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-md transition"
          >
            <i class="fas fa-plus mr-2"></i> Cập nhật
          </button>
        </div>
      </form>
    </main>
    ` }) %>
  </body>
</html>
